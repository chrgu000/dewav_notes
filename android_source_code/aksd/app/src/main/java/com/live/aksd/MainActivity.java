package com.live.aksd;import android.content.Intent;import android.os.Bundle;import android.os.SystemClock;import android.support.annotation.IdRes;import android.support.v4.app.Fragment;import android.support.v4.app.FragmentTransaction;import android.view.View;import android.widget.FrameLayout;import android.widget.RadioButton;import android.widget.RadioGroup;import com.king.base.util.ToastUtils;import com.live.aksd.bean.FirstEvent;import com.live.aksd.bean.UserBean;import com.live.aksd.mvp.activity.ContentActivity;import com.live.aksd.mvp.base.PureActivity;import com.live.aksd.mvp.fragment.Home.HomeFragment;import com.live.aksd.mvp.fragment.JsWebFragment;import com.live.aksd.mvp.fragment.Mine.MineFragment;import com.live.aksd.mvp.fragment.WorkOrder.WordOrderFragment;import com.live.aksd.util.SpSingleInstance;import org.greenrobot.eventbus.EventBus;import org.greenrobot.eventbus.Subscribe;import org.greenrobot.eventbus.ThreadMode;import butterknife.BindView;import butterknife.ButterKnife;import butterknife.OnClick;public class MainActivity extends PureActivity {    @BindView(R.id.fragmentContent)    FrameLayout fragmentContent;    @BindView(R.id.rbHome)    RadioButton rbHome;    @BindView(R.id.rbGD)    RadioButton rbGD;    @BindView(R.id.rbSC)    RadioButton rbSC;    @BindView(R.id.rbMe)    RadioButton rbMe;    @BindView(R.id.rg)    RadioGroup rg;    private boolean isExit;    private UserBean userBean;    private HomeFragment homeFragment;    private MineFragment mineFragment;    private WordOrderFragment wordOrderFragment;    private JsWebFragment jsWebFragment;    private int state=0;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        ButterKnife.bind(this);        EventBus.getDefault().register(this);        userBean = SpSingleInstance.getSpSingleInstance().getUserBean();    }    @Override    protected void onDestroy() {        super.onDestroy();        EventBus.getDefault().unregister(this);    }    @Override    public int getRootViewId() {        return R.layout.activity_main;    }    @Override    public void initUI() {        showHomeFragment();    }    @Override    protected void onResume() {        super.onResume();        if("0".equals(state+"")){            rbHome.setChecked(true);            showHomeFragment();        }    }    @Override    public void onBackPressed() {        //由于推送服务会造成toast关闭不掉，所以去掉再按一次退出        if (!isExit) {            ToastUtils.showToast(context.getApplicationContext(), R.string.press_again_to_exit);            isExit = true;            EventBus.getDefault().post(isExit);        } else {            super.onBackPressed();        }        //App.getInstance().exit();    }    @Subscribe(threadMode = ThreadMode.ASYNC)    public void onEventExit(Boolean isBool) {        SystemClock.sleep(1000);        isExit = false;    }    @Subscribe(threadMode = ThreadMode.MAIN)    public void onEventMainThread(FirstEvent event) {        if (event.getMsg().equals("1")) {        } else if (event.getMsg().equals("2")) {        } else if (event.getMsg().equals("3")) {            finish();        } else if (event.getMsg().equals("20")) {            state=0;        }    }    public void commitShowFragment(FragmentTransaction fragmentTransaction, Fragment fragment) {        fragmentTransaction.show(fragment);        fragmentTransaction.commit();    }    //首页    public void showHomeFragment() {        FragmentTransaction fragmentTransaction = getSupportFragmentManager().beginTransaction();        hideAllFragment(fragmentTransaction);        if (homeFragment == null) {            homeFragment = HomeFragment.newInstance();            fragmentTransaction.add(R.id.fragmentContent, homeFragment);        }        commitShowFragment(fragmentTransaction, homeFragment);    }    //我的    public void showMineFragment() {        FragmentTransaction fragmentTransaction = getSupportFragmentManager().beginTransaction();        hideAllFragment(fragmentTransaction);        if (mineFragment == null) {            mineFragment = MineFragment.newInstance();            fragmentTransaction.add(R.id.fragmentContent, mineFragment);        }        commitShowFragment(fragmentTransaction, mineFragment);    }    //工单    public void showWordOrderFragment() {        FragmentTransaction fragmentTransaction = getSupportFragmentManager().beginTransaction();        hideAllFragment(fragmentTransaction);        if (wordOrderFragment == null) {            wordOrderFragment = WordOrderFragment.newInstance();            fragmentTransaction.add(R.id.fragmentContent, wordOrderFragment);        }        commitShowFragment(fragmentTransaction, wordOrderFragment);    }    //商城    public void showMallFragment() {        FragmentTransaction fragmentTransaction = getSupportFragmentManager().beginTransaction();        hideAllFragment(fragmentTransaction);        if (jsWebFragment == null) {            jsWebFragment = JsWebFragment.newInstance("http://aksd.qubaotang.cn/app-mall1/#/home?member_id=" + userBean.getMember_id() + "&member_token=" + userBean.getMember_token(), getText(R.string.app_mall).toString(), "3", "");            fragmentTransaction.add(R.id.fragmentContent, jsWebFragment);        }        commitShowFragment(fragmentTransaction, jsWebFragment);    }    public void hideAllFragment(FragmentTransaction fragmentTransaction) {        hideFragment(fragmentTransaction, homeFragment);        hideFragment(fragmentTransaction, mineFragment);        hideFragment(fragmentTransaction, wordOrderFragment);        hideFragment(fragmentTransaction, jsWebFragment);    }    private void hideFragment(FragmentTransaction fragmentTransaction, Fragment fragment) {        if (fragment != null) {            fragmentTransaction.hide(fragment);        }    }    public void replaceFragment(@IdRes int id, Fragment fragment) {        getSupportFragmentManager().beginTransaction().replace(id, fragment).commit();    }    protected void startWeb(String title, String img, String url, String type) {        Intent intent = getFragmentIntent(Constants.WEB_FRAGMENT);        intent.putExtra(Constants.KEY_TITLE, title);        intent.putExtra(Constants.IMG, img);        intent.putExtra(Constants.KEY_URL, url);        intent.putExtra(Constants.KEY_SLUG, type);        startActivity(intent);    }    protected Intent getFragmentIntent(int fragmentKey) {        Intent intent = getContentActivityIntent();        intent.putExtra(Constants.KEY_FRAGMENT, fragmentKey);        return intent;    }    protected Intent getContentActivityIntent() {        return new Intent(context, ContentActivity.class);    }    @OnClick({R.id.rbHome, R.id.rbGD, R.id.rbSC, R.id.rbMe})    public void onViewClicked(View view) {        switch (view.getId()) {            case R.id.rbHome:                state=0;                showHomeFragment();                break;            case R.id.rbGD:                state=1;                showWordOrderFragment();                break;            case R.id.rbSC:                if (state==0){                    rbHome.setChecked(true);                }else if(state==1){                    rbGD.setChecked(true);                }else if(state==2){                    rbMe.setChecked(true);                }                EventBus.getDefault().post(new FirstEvent("30"));                //jsWebFragment = JsWebFragment.newInstance(" http://aksd.tstweiguanjia.com/app-mall1/index.html#/home?member_id=" + userBean.getMember_id() + "&member_token=" + userBean.getMember_token(), getText(R.string.app_mall).toString(), "3", "");                //startWeb("", "", "http://aksd.tstweiguanjia.com/app-mall1/#/home?member_id=" + userBean.getMember_id() + "&member_token=" + userBean.getMember_token()+"&add="+"", "1");                break;            case R.id.rbMe:                state=2;                showMineFragment();                break;        }    }}